import "dart:html" as PB;import "dart:math" as SB;import "dart:typed_data" as TB;var QB=2;var JB;var KB;var aB;var LB;var CB;var UB;var MB;var NB;var WB=0.0;var VB=new l(0.005,0.005,0.005);final  q=new l(MB.toDouble(),NB.toDouble(),100.0);final  BB=new m.wB();final  u=new SB.Random(100);var IB; get bB=>MB; get cB=>NB; get dB{return '#${(u.nextInt(128)+128).toRadixString(16)}${(u.nextInt(128)+128).toRadixString(16)}${(u.nextInt(128)+128).toRadixString(16)}';} main(){JB=PB.query("#container");LB=PB.query("#lifecycle");CB=PB.query("#numParticles");CB.value="5000";CB.onInput.listen(eB);aB=new PB.CanvasElement(width:QB,height:QB);PB.window.setImmediate(DB);} eB( s){PB.window.cancelAnimationFrame(UB);var h=o.DB;var i;var j=0;if(CB.value!="")j=int.parse(CB.value);var k=0;while (h.next!=null){h=h.next;}while (h.last!=null&&k<j){if(h.next!=null)h.next=null;if(i!=null)i.last=null;i=h;h=h.last; ++k;}if(j<=0)o.DB=null;DB();} DB(){KB=JB.context2D;var k=JB.parent.client;MB=k.width;NB=k.height;JB.width=MB;JB.height=NB;IB=KB.createImageData(1,1);var v=IB.data.length-1;for(int i=0;i<v;i+= 4){IB.data[i]=u.nextInt(255);IB.data[i+1]=u.nextInt(255);IB.data[i+2]=u.nextInt(255);IB.data[i+3]=255;}var s=0;var h;var j;if(o.DB!=null){h=o.DB;while (h.next!=null)h=h.next;j=h;}if(CB.value!="")s=int.parse(CB.value);var AB=dB;for(int i=0;i<s; ++i){h=new o(u.nextDouble()*q.x,u.nextDouble()*q.y,u.nextDouble()*q.z,AB);if(j!=null){h.last=j;j.next=h;}j=h;if(o.DB==null)o.DB=h;}UB=PB.window.requestAnimationFrame(XB);PB.window.onClick.listen(fB);} fB( h){print("onClick ${h}");} XB( i){var j=i-WB;WB=i;LB.text="Life cycle: ${i.floorToDouble()}";LB.text=LB.text.substring(0,LB.text.length-2);KB.clearRect(0,0,bB,cB);BB.ZB();BB.translate(q.x*0.5,q.y*0.5,q.z*0.5);BB.kB(VB.x);BB.lB(VB.y);BB.mB(VB.z);BB.translate(-q.x*0.5,-q.y*0.5,-q.z*0.5);var h=o.DB;while (h!=null){h.jB(j);h=h.next;}UB=PB.window.requestAnimationFrame(XB);}class o{static var DB;var parent;var last;var next;var xB;var yB;var zB;var AC;o( h, i, j,this.AC){xB=new l(h,i,j);yB=new t(0.0,0.0);zB=u.nextDouble()*SB.PI*2;YB(xB,yB);} jB( i){var h=false;if(xB.x<0||xB.x>q.x){xB.x=SB.max(0,SB.min(q.x,xB.x)).toDouble();h=true;}if(xB.y<0||xB.y>q.y){xB.y=SB.max(0,SB.min(q.y,xB.y)).toDouble();h=true;}if(h)zB+= SB.PI;YB(xB,yB);KB.fillStyle=AC;KB.fillRect(yB.x.toInt(),yB.y.toInt(),QB,QB);xB.x+= SB.cos(zB);xB.y+= SB.sin(zB);}static  YB( j, i){var h=BB.nB(j);h.gB(BB);i.x=h.x+(MB-q.x)*0.5;i.y=h.y+(NB-q.y)*0.5;}}class oB{static const  pB="Chrome";static const  qB="Firefox";final  hB;final  minimumVersion;const oB(this.hB,[this.minimumVersion]);}class rB{const rB();}class sB{final  name;const sB(this.name);}class tB{const tB();}class uB{const uB();}class l{final  g=new TB.Float32List(3);l( h, i, j){OB(h,i,j);}l.vB(); OB( h, i, j){g[0]=h;g[1]=i;g[2]=j;return this;} toString()=>'[${g[0]},${g[1]},${g[2]}]'; operator-()=>new l(-g[0],-g[1],-g[2]); operator-( h)=>new l(g[0]-h.g[0],g[1]-h.g[1],g[2]-h.g[2]); operator+( h)=>new l(g[0]+h.g[0],g[1]+h.g[1],g[2]+h.g[2]); operator/( i){var h=1.0/i;return new l(g[0]*h,g[1]*h,g[2]*h);} operator*( i){var h=i;return new l(g[0]*h,g[1]*h,g[2]*h);} operator[]( h)=>g[h]; operator[]=( h, i){g[h]=i;} get length{var h;h=(g[0]*g[0]);h+= (g[1]*g[1]);h+= (g[2]*g[2]);return SB.sqrt(h);} gB( h){var BC=g[0];var CC=g[1];var DC=g[2];var i=1.0/(h.g[3]*BC+h.g[7]*CC+h.g[11]*DC+h.g[15]);g[0]=(h.g[0]*BC+h.g[4]*CC+h.g[8]*DC+h.g[12])*i;g[1]=(h.g[1]*BC+h.g[5]*CC+h.g[9]*DC+h.g[13])*i;g[2]=(h.g[2]*BC+h.g[6]*CC+h.g[10]*DC+h.g[14])*i;return this;} get isNaN{var h=false;h=h||g[0].isNaN;h=h||g[1].isNaN;h=h||g[2].isNaN;return h;} add( h){g[0]=g[0]+h.g[0];g[1]=g[1]+h.g[1];g[2]=g[2]+h.g[2];return this;}set x( h)=>g[0]=h;set y( h)=>g[1]=h;set z( h)=>g[2]=h; get x=>g[0]; get y=>g[1]; get z=>g[2];}class n{final  g=new TB.Float32List(4);n( h, i, j, k){OB(h,i,j,k);}n.vB(); OB( h, i, j, k){g[3]=k;g[2]=j;g[1]=i;g[0]=h;return this;} toString()=>'${g[0]},${g[1]},' '${g[2]},${g[3]}'; operator-()=>new n(-g[0],-g[1],-g[2],-g[3]); operator-( h)=>new n(g[0]-h.g[0],g[1]-h.g[1],g[2]-h.g[2],g[3]-h.g[3]); operator+( h)=>new n(g[0]+h.g[0],g[1]+h.g[1],g[2]+h.g[2],g[3]+h.g[3]); operator/( i){var h=1.0/i;return new n(g[0]*h,g[1]*h,g[2]*h,g[3]*h);} operator*( i){var h=i;return new n(g[0]*h,g[1]*h,g[2]*h,g[3]*h);} operator[]( h)=>g[h]; operator[]=( h, i){g[h]=i;} get length{var h;h=(g[0]*g[0]);h+= (g[1]*g[1]);h+= (g[2]*g[2]);h+= (g[3]*g[3]);return SB.sqrt(h);} get isNaN{var h=false;h=h||g[0].isNaN;h=h||g[1].isNaN;h=h||g[2].isNaN;h=h||g[3].isNaN;return h;} add( h){g[0]=g[0]+h.g[0];g[1]=g[1]+h.g[1];g[2]=g[2]+h.g[2];g[3]=g[3]+h.g[3];return this;}set x( h)=>g[0]=h;set y( h)=>g[1]=h;set z( h)=>g[2]=h; get x=>g[0]; get y=>g[1]; get z=>g[2]; get w=>g[3];}class t{final  g=new TB.Float32List(2);t( h, i){OB(h,i);} OB( h, i){g[0]=h;g[1]=i;return this;} toString()=>'[${g[0]},${g[1]}]'; operator-()=>new t(-g[0],-g[1]); operator-( h)=>new t(g[0]-h.g[0],g[1]-h.g[1]); operator+( h)=>new t(g[0]+h.g[0],g[1]+h.g[1]); operator/( i){var h=1.0/i;return new t(g[0]*h,g[1]*h);} operator*( i){var h=i;return new t(g[0]*h,g[1]*h);} operator[]( h)=>g[h]; operator[]=( h, i){g[h]=i;} get length{var h;h=(g[0]*g[0]);h+= (g[1]*g[1]);return SB.sqrt(h);} get isNaN{var h=false;h=h||g[0].isNaN;h=h||g[1].isNaN;return h;} add( h){g[0]=g[0]+h.g[0];g[1]=g[1]+h.g[1];return this;}set x( h)=>g[0]=h;set y( h)=>g[1]=h; get x=>g[0]; get y=>g[1];}class m{final  g=new TB.Float32List(16); index( h, i)=>(i*4)+h; entry( h, i)=>g[index(h,i)];m.vB();m.wB(){ZB();} toString(){var h='';h='${h}[0] ${RB(0)}\n';h='${h}[1] ${RB(1)}\n';h='${h}[2] ${RB(2)}\n';h='${h}[3] ${RB(3)}\n';return h;} get iB=>4; operator[]( h)=>g[h]; operator[]=( h, i){g[h]=i;} RB( i){var h=new n.vB();h.g[0]=g[index(i,0)];h.g[1]=g[index(i,1)];h.g[2]=g[index(i,2)];h.g[3]=g[index(i,3)];return h;} EC( i){var h=new m.vB();h.g[15]=g[15]*i;h.g[14]=g[14]*i;h.g[13]=g[13]*i;h.g[12]=g[12]*i;h.g[11]=g[11]*i;h.g[10]=g[10]*i;h.g[9]=g[9]*i;h.g[8]=g[8]*i;h.g[7]=g[7]*i;h.g[6]=g[6]*i;h.g[5]=g[5]*i;h.g[4]=g[4]*i;h.g[3]=g[3]*i;h.g[2]=g[2]*i;h.g[1]=g[1]*i;h.g[0]=g[0]*i;return h;} FC( h){var i=new m.vB();i.g[0]=(g[0]*h.g[0])+(g[4]*h.g[1])+(g[8]*h.g[2])+(g[12]*h.g[3]);i.g[4]=(g[0]*h.g[4])+(g[4]*h.g[5])+(g[8]*h.g[6])+(g[12]*h.g[7]);i.g[8]=(g[0]*h.g[8])+(g[4]*h.g[9])+(g[8]*h.g[10])+(g[12]*h.g[11]);i.g[12]=(g[0]*h.g[12])+(g[4]*h.g[13])+(g[8]*h.g[14])+(g[12]*h.g[15]);i.g[1]=(g[1]*h.g[0])+(g[5]*h.g[1])+(g[9]*h.g[2])+(g[13]*h.g[3]);i.g[5]=(g[1]*h.g[4])+(g[5]*h.g[5])+(g[9]*h.g[6])+(g[13]*h.g[7]);i.g[9]=(g[1]*h.g[8])+(g[5]*h.g[9])+(g[9]*h.g[10])+(g[13]*h.g[11]);i.g[13]=(g[1]*h.g[12])+(g[5]*h.g[13])+(g[9]*h.g[14])+(g[13]*h.g[15]);i.g[2]=(g[2]*h.g[0])+(g[6]*h.g[1])+(g[10]*h.g[2])+(g[14]*h.g[3]);i.g[6]=(g[2]*h.g[4])+(g[6]*h.g[5])+(g[10]*h.g[6])+(g[14]*h.g[7]);i.g[10]=(g[2]*h.g[8])+(g[6]*h.g[9])+(g[10]*h.g[10])+(g[14]*h.g[11]);i.g[14]=(g[2]*h.g[12])+(g[6]*h.g[13])+(g[10]*h.g[14])+(g[14]*h.g[15]);i.g[3]=(g[3]*h.g[0])+(g[7]*h.g[1])+(g[11]*h.g[2])+(g[15]*h.g[3]);i.g[7]=(g[3]*h.g[4])+(g[7]*h.g[5])+(g[11]*h.g[6])+(g[15]*h.g[7]);i.g[11]=(g[3]*h.g[8])+(g[7]*h.g[9])+(g[11]*h.g[10])+(g[15]*h.g[11]);i.g[15]=(g[3]*h.g[12])+(g[7]*h.g[13])+(g[11]*h.g[14])+(g[15]*h.g[15]);return i;} GC( h){var i=new n.vB();i.g[3]=(g[3]*h.g[0])+(g[7]*h.g[1])+(g[11]*h.g[2])+(g[15]*h.g[3]);i.g[2]=(g[2]*h.g[0])+(g[6]*h.g[1])+(g[10]*h.g[2])+(g[14]*h.g[3]);i.g[1]=(g[1]*h.g[0])+(g[5]*h.g[1])+(g[9]*h.g[2])+(g[13]*h.g[3]);i.g[0]=(g[0]*h.g[0])+(g[4]*h.g[1])+(g[8]*h.g[2])+(g[12]*h.g[3]);return i;} HC( h){var i=new l.vB();i.g[0]=(g[0]*h.g[0])+(g[4]*h.g[1])+(g[8]*h.g[2])+g[12];i.g[1]=(g[1]*h.g[0])+(g[5]*h.g[1])+(g[9]*h.g[2])+g[13];i.g[2]=(g[2]*h.g[0])+(g[6]*h.g[1])+(g[10]*h.g[2])+g[14];return i;} operator*( h){if(h is double){return EC(h);}if(h is n){return GC(h);}if(h is l){return HC(h);}if(4==h.iB){return FC(h);}throw new ArgumentError(h);} operator+( i){var h=new m.vB();h.g[0]=g[0]+i.g[0];h.g[1]=g[1]+i.g[1];h.g[2]=g[2]+i.g[2];h.g[3]=g[3]+i.g[3];h.g[4]=g[4]+i.g[4];h.g[5]=g[5]+i.g[5];h.g[6]=g[6]+i.g[6];h.g[7]=g[7]+i.g[7];h.g[8]=g[8]+i.g[8];h.g[9]=g[9]+i.g[9];h.g[10]=g[10]+i.g[10];h.g[11]=g[11]+i.g[11];h.g[12]=g[12]+i.g[12];h.g[13]=g[13]+i.g[13];h.g[14]=g[14]+i.g[14];h.g[15]=g[15]+i.g[15];return h;} operator-( i){var h=new m.vB();h.g[0]=g[0]-i.g[0];h.g[1]=g[1]-i.g[1];h.g[2]=g[2]-i.g[2];h.g[3]=g[3]-i.g[3];h.g[4]=g[4]-i.g[4];h.g[5]=g[5]-i.g[5];h.g[6]=g[6]-i.g[6];h.g[7]=g[7]-i.g[7];h.g[8]=g[8]-i.g[8];h.g[9]=g[9]-i.g[9];h.g[10]=g[10]-i.g[10];h.g[11]=g[11]-i.g[11];h.g[12]=g[12]-i.g[12];h.g[13]=g[13]-i.g[13];h.g[14]=g[14]-i.g[14];h.g[15]=g[15]-i.g[15];return h;} translate( h,[ v=0.0, AB=0.0]){var i;var j;var k;var s=h is n?h.w:1.0;if(h is l||h is n){i=h.x;j=h.y;k=h.z;}else{i=h;j=v;k=AB;}var EB=g[0]*i+g[4]*j+g[8]*k+g[12]*s;var FB=g[1]*i+g[5]*j+g[9]*k+g[13]*s;var GB=g[2]*i+g[6]*j+g[10]*k+g[14]*s;var HB=g[3]*i+g[7]*j+g[11]*k+g[15]*s;g[12]=EB;g[13]=FB;g[14]=GB;g[15]=HB;return this;} kB( j){var h=SB.cos(j);var i=SB.sin(j);var k=g[4]*h+g[8]*i;var s=g[5]*h+g[9]*i;var v=g[6]*h+g[10]*i;var AB=g[7]*h+g[11]*i;var EB=g[4]*-i+g[8]*h;var FB=g[5]*-i+g[9]*h;var GB=g[6]*-i+g[10]*h;var HB=g[7]*-i+g[11]*h;g[4]=k;g[5]=s;g[6]=v;g[7]=AB;g[8]=EB;g[9]=FB;g[10]=GB;g[11]=HB;return this;} lB( j){var h=SB.cos(j);var i=SB.sin(j);var k=g[0]*h+g[8]*i;var s=g[1]*h+g[9]*i;var v=g[2]*h+g[10]*i;var AB=g[3]*h+g[11]*i;var EB=g[0]*-i+g[8]*h;var FB=g[1]*-i+g[9]*h;var GB=g[2]*-i+g[10]*h;var HB=g[3]*-i+g[11]*h;g[0]=k;g[1]=s;g[2]=v;g[3]=AB;g[8]=EB;g[9]=FB;g[10]=GB;g[11]=HB;return this;} mB( j){var h=SB.cos(j);var i=SB.sin(j);var k=g[0]*h+g[4]*i;var s=g[1]*h+g[5]*i;var v=g[2]*h+g[6]*i;var AB=g[3]*h+g[7]*i;var EB=g[0]*-i+g[4]*h;var FB=g[1]*-i+g[5]*h;var GB=g[2]*-i+g[6]*h;var HB=g[3]*-i+g[7]*h;g[0]=k;g[1]=s;g[2]=v;g[3]=AB;g[4]=EB;g[5]=FB;g[6]=GB;g[7]=HB;return this;} operator-(){var h=new m.vB();h[0]=-g[0];h[1]=-g[1];h[2]=-g[2];h[3]=-g[3];return h;} ZB(){g[0]=1.0;g[1]=0.0;g[2]=0.0;g[3]=0.0;g[4]=0.0;g[5]=1.0;g[6]=0.0;g[7]=0.0;g[8]=0.0;g[9]=0.0;g[10]=1.0;g[11]=0.0;g[12]=0.0;g[13]=0.0;g[14]=0.0;g[15]=1.0;return this;} add( h){g[0]=g[0]+h.g[0];g[1]=g[1]+h.g[1];g[2]=g[2]+h.g[2];g[3]=g[3]+h.g[3];g[4]=g[4]+h.g[4];g[5]=g[5]+h.g[5];g[6]=g[6]+h.g[6];g[7]=g[7]+h.g[7];g[8]=g[8]+h.g[8];g[9]=g[9]+h.g[9];g[10]=g[10]+h.g[10];g[11]=g[11]+h.g[11];g[12]=g[12]+h.g[12];g[13]=g[13]+h.g[13];g[14]=g[14]+h.g[14];g[15]=g[15]+h.g[15];return this;} nB( h){var i=(g[0]*h.g[0])+(g[4]*h.g[1])+(g[8]*h.g[2])+g[12];var j=(g[1]*h.g[0])+(g[5]*h.g[1])+(g[9]*h.g[2])+g[13];var k=(g[2]*h.g[0])+(g[6]*h.g[1])+(g[10]*h.g[2])+g[14];h.x=i;h.y=j;h.z=k;return h;}}