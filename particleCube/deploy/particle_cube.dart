import "dart:math" as MB;import "dart:typed_data" as NB;import "dart:html" as QB;var RB=2;var HB;var u;var IB;var KB;var SB=0.0;var OB=new k(0.005,0.005,0.005);final  o=new k(IB*0.5,KB*0.5,100.0);final  v=new l.nB();final  AB=new MB.Random(100); get WB=>IB; get XB=>KB; get YB{return '#${AB.nextInt(255).toRadixString(16)}${AB.nextInt(255).toRadixString(16)}${AB.nextInt(255).toRadixString(16)}';} main(){HB=QB.query("#container");u=HB.context2D;IB=(HB.parent as QB.Element).clientWidth;KB=(HB.parent as QB.Element).clientHeight;HB.width=IB;var h;var i;for(int j=0;j<5000; ++j){h=new s(AB.nextDouble()*o.x,AB.nextDouble()*o.y,AB.nextDouble()*o.z,YB);if(i!=null){h.last=i;i.next=h;}i=h;if(s.PB==null)s.PB=h;}u.fillStyle="#FFFFFF";u.setTransform(1,0,0,1,0,0);QB.window.requestAnimationFrame(TB);QB.window.onClick.listen(ZB);} ZB( h){print("onClick ${h}");} TB( i){var j=i-SB;SB=i;print(j);aB();v.VB();v.translate(o.x*0.5,o.y*0.5,o.z*0.5);v.eB(OB.x);v.fB(OB.y);v.gB(OB.z);v.translate(-o.x*0.5,-o.y*0.5,-o.z*0.5);var h=s.PB;while (h!=null){h.dB(j);h=h.next;}QB.window.requestAnimationFrame(TB);} aB(){u.save();u.transform(1,0,0,1,0,0);u.clearRect(0,0,WB,XB);u.restore();}class s{static var PB;var parent;var last;var next;var oB;var pB;var qB;var rB;s( i, h, j,this.rB){oB=new k(i,h,j);pB=new q(0.0,0.0);qB=AB.nextDouble()*MB.PI*2;UB(oB,pB);} dB( i){var h=false;if(oB.x<0||oB.x>o.x){oB.x=MB.max(0,MB.min(o.x,oB.x)).toDouble();h=true;}if(oB.y<0||oB.y>o.y){oB.y=MB.max(0,MB.min(o.y,oB.y)).toDouble();h=true;}if(h)qB+= MB.PI;UB(oB,pB);u.fillStyle=rB;u.fillRect(pB.x.toInt(),pB.y.toInt(),RB,RB);oB.x+= MB.cos(qB);oB.y+= MB.sin(qB);}static  UB( j, i){var h=v.hB(j);h.bB(v);i.x=h.x+(IB-o.x)*0.5;i.y=h.y+(KB-o.y)*0.5;}}class iB{const iB();}class jB{final  name;const jB(this.name);}class kB{const kB();}class q{final  g=new NB.Float32List(2);q( i, h){JB(i,h);} JB( i, h){g[0]=i;g[1]=h;return this;} toString()=>'[${g[0]},${g[1]}]'; operator-()=>new q(-g[0],-g[1]); operator-( h)=>new q(g[0]-h.g[0],g[1]-h.g[1]); operator+( h)=>new q(g[0]+h.g[0],g[1]+h.g[1]); operator/( i){var h=1.0/i;return new q(g[0]*h,g[1]*h);} operator*( i){var h=i;return new q(g[0]*h,g[1]*h);} operator[]( h)=>g[h]; operator[]=( i, h){g[i]=h;} get length{var h;h=(g[0]*g[0]);h+= (g[1]*g[1]);return MB.sqrt(h);} get isNaN{var h=false;h=h||g[0].isNaN;h=h||g[1].isNaN;return h;} add( h){g[0]=g[0]+h.g[0];g[1]=g[1]+h.g[1];return this;}set x( h)=>g[0]=h;set y( h)=>g[1]=h; get x=>g[0]; get y=>g[1];}class k{final  g=new NB.Float32List(3);k( j, i, h){JB(j,i,h);}k.mB(); JB( j, i, h){g[0]=j;g[1]=i;g[2]=h;return this;} toString()=>'[${g[0]},${g[1]},${g[2]}]'; operator-()=>new k(-g[0],-g[1],-g[2]); operator-( h)=>new k(g[0]-h.g[0],g[1]-h.g[1],g[2]-h.g[2]); operator+( h)=>new k(g[0]+h.g[0],g[1]+h.g[1],g[2]+h.g[2]); operator/( i){var h=1.0/i;return new k(g[0]*h,g[1]*h,g[2]*h);} operator*( i){var h=i;return new k(g[0]*h,g[1]*h,g[2]*h);} operator[]( h)=>g[h]; operator[]=( i, h){g[i]=h;} get length{var h;h=(g[0]*g[0]);h+= (g[1]*g[1]);h+= (g[2]*g[2]);return MB.sqrt(h);} bB( h){var sB=g[0];var tB=g[1];var uB=g[2];var i=1.0/(h.g[3]*sB+h.g[7]*tB+h.g[11]*uB+h.g[15]);g[0]=(h.g[0]*sB+h.g[4]*tB+h.g[8]*uB+h.g[12])*i;g[1]=(h.g[1]*sB+h.g[5]*tB+h.g[9]*uB+h.g[13])*i;g[2]=(h.g[2]*sB+h.g[6]*tB+h.g[10]*uB+h.g[14])*i;return this;} get isNaN{var h=false;h=h||g[0].isNaN;h=h||g[1].isNaN;h=h||g[2].isNaN;return h;} add( h){g[0]=g[0]+h.g[0];g[1]=g[1]+h.g[1];g[2]=g[2]+h.g[2];return this;}set x( h)=>g[0]=h;set y( h)=>g[1]=h;set z( h)=>g[2]=h; get x=>g[0]; get y=>g[1]; get z=>g[2];}class m{final  g=new NB.Float32List(4);m( n, i, h, j){JB(n,i,h,j);}m.mB(); JB( n, i, h, j){g[3]=j;g[2]=h;g[1]=i;g[0]=n;return this;} toString()=>'${g[0]},${g[1]},' '${g[2]},${g[3]}'; operator-()=>new m(-g[0],-g[1],-g[2],-g[3]); operator-( h)=>new m(g[0]-h.g[0],g[1]-h.g[1],g[2]-h.g[2],g[3]-h.g[3]); operator+( h)=>new m(g[0]+h.g[0],g[1]+h.g[1],g[2]+h.g[2],g[3]+h.g[3]); operator/( i){var h=1.0/i;return new m(g[0]*h,g[1]*h,g[2]*h,g[3]*h);} operator*( i){var h=i;return new m(g[0]*h,g[1]*h,g[2]*h,g[3]*h);} operator[]( h)=>g[h]; operator[]=( i, h){g[i]=h;} get length{var h;h=(g[0]*g[0]);h+= (g[1]*g[1]);h+= (g[2]*g[2]);h+= (g[3]*g[3]);return MB.sqrt(h);} get isNaN{var h=false;h=h||g[0].isNaN;h=h||g[1].isNaN;h=h||g[2].isNaN;h=h||g[3].isNaN;return h;} add( h){g[0]=g[0]+h.g[0];g[1]=g[1]+h.g[1];g[2]=g[2]+h.g[2];g[3]=g[3]+h.g[3];return this;}set x( h)=>g[0]=h;set y( h)=>g[1]=h;set z( h)=>g[2]=h; get x=>g[0]; get y=>g[1]; get z=>g[2]; get w=>g[3];}class l{final  g=new NB.Float32List(16); index( h, i)=>(i*4)+h;l.mB();l.nB(){VB();} toString(){var h='';h='${h}[0] ${LB(0)}\n';h='${h}[1] ${LB(1)}\n';h='${h}[2] ${LB(2)}\n';h='${h}[3] ${LB(3)}\n';return h;} get cB=>4; operator[]( h)=>g[h]; operator[]=( i, h){g[i]=h;} LB( i){var h=new m.mB();h.g[0]=g[index(i,0)];h.g[1]=g[index(i,1)];h.g[2]=g[index(i,2)];h.g[3]=g[index(i,3)];return h;} vB( i){var h=new l.mB();h.g[15]=g[15]*i;h.g[14]=g[14]*i;h.g[13]=g[13]*i;h.g[12]=g[12]*i;h.g[11]=g[11]*i;h.g[10]=g[10]*i;h.g[9]=g[9]*i;h.g[8]=g[8]*i;h.g[7]=g[7]*i;h.g[6]=g[6]*i;h.g[5]=g[5]*i;h.g[4]=g[4]*i;h.g[3]=g[3]*i;h.g[2]=g[2]*i;h.g[1]=g[1]*i;h.g[0]=g[0]*i;return h;} wB( h){var i=new l.mB();i.g[0]=(g[0]*h.g[0])+(g[4]*h.g[1])+(g[8]*h.g[2])+(g[12]*h.g[3]);i.g[4]=(g[0]*h.g[4])+(g[4]*h.g[5])+(g[8]*h.g[6])+(g[12]*h.g[7]);i.g[8]=(g[0]*h.g[8])+(g[4]*h.g[9])+(g[8]*h.g[10])+(g[12]*h.g[11]);i.g[12]=(g[0]*h.g[12])+(g[4]*h.g[13])+(g[8]*h.g[14])+(g[12]*h.g[15]);i.g[1]=(g[1]*h.g[0])+(g[5]*h.g[1])+(g[9]*h.g[2])+(g[13]*h.g[3]);i.g[5]=(g[1]*h.g[4])+(g[5]*h.g[5])+(g[9]*h.g[6])+(g[13]*h.g[7]);i.g[9]=(g[1]*h.g[8])+(g[5]*h.g[9])+(g[9]*h.g[10])+(g[13]*h.g[11]);i.g[13]=(g[1]*h.g[12])+(g[5]*h.g[13])+(g[9]*h.g[14])+(g[13]*h.g[15]);i.g[2]=(g[2]*h.g[0])+(g[6]*h.g[1])+(g[10]*h.g[2])+(g[14]*h.g[3]);i.g[6]=(g[2]*h.g[4])+(g[6]*h.g[5])+(g[10]*h.g[6])+(g[14]*h.g[7]);i.g[10]=(g[2]*h.g[8])+(g[6]*h.g[9])+(g[10]*h.g[10])+(g[14]*h.g[11]);i.g[14]=(g[2]*h.g[12])+(g[6]*h.g[13])+(g[10]*h.g[14])+(g[14]*h.g[15]);i.g[3]=(g[3]*h.g[0])+(g[7]*h.g[1])+(g[11]*h.g[2])+(g[15]*h.g[3]);i.g[7]=(g[3]*h.g[4])+(g[7]*h.g[5])+(g[11]*h.g[6])+(g[15]*h.g[7]);i.g[11]=(g[3]*h.g[8])+(g[7]*h.g[9])+(g[11]*h.g[10])+(g[15]*h.g[11]);i.g[15]=(g[3]*h.g[12])+(g[7]*h.g[13])+(g[11]*h.g[14])+(g[15]*h.g[15]);return i;} xB( h){var i=new m.mB();i.g[3]=(g[3]*h.g[0])+(g[7]*h.g[1])+(g[11]*h.g[2])+(g[15]*h.g[3]);i.g[2]=(g[2]*h.g[0])+(g[6]*h.g[1])+(g[10]*h.g[2])+(g[14]*h.g[3]);i.g[1]=(g[1]*h.g[0])+(g[5]*h.g[1])+(g[9]*h.g[2])+(g[13]*h.g[3]);i.g[0]=(g[0]*h.g[0])+(g[4]*h.g[1])+(g[8]*h.g[2])+(g[12]*h.g[3]);return i;} yB( h){var i=new k.mB();i.g[0]=(g[0]*h.g[0])+(g[4]*h.g[1])+(g[8]*h.g[2])+g[12];i.g[1]=(g[1]*h.g[0])+(g[5]*h.g[1])+(g[9]*h.g[2])+g[13];i.g[2]=(g[2]*h.g[0])+(g[6]*h.g[1])+(g[10]*h.g[2])+g[14];return i;} operator*( h){if(h is double){return vB(h);}if(h is m){return xB(h);}if(h is k){return yB(h);}if(4==h.cB){return wB(h);}throw new ArgumentError(h);} operator+( i){var h=new l.mB();h.g[0]=g[0]+i.g[0];h.g[1]=g[1]+i.g[1];h.g[2]=g[2]+i.g[2];h.g[3]=g[3]+i.g[3];h.g[4]=g[4]+i.g[4];h.g[5]=g[5]+i.g[5];h.g[6]=g[6]+i.g[6];h.g[7]=g[7]+i.g[7];h.g[8]=g[8]+i.g[8];h.g[9]=g[9]+i.g[9];h.g[10]=g[10]+i.g[10];h.g[11]=g[11]+i.g[11];h.g[12]=g[12]+i.g[12];h.g[13]=g[13]+i.g[13];h.g[14]=g[14]+i.g[14];h.g[15]=g[15]+i.g[15];return h;} operator-( i){var h=new l.mB();h.g[0]=g[0]-i.g[0];h.g[1]=g[1]-i.g[1];h.g[2]=g[2]-i.g[2];h.g[3]=g[3]-i.g[3];h.g[4]=g[4]-i.g[4];h.g[5]=g[5]-i.g[5];h.g[6]=g[6]-i.g[6];h.g[7]=g[7]-i.g[7];h.g[8]=g[8]-i.g[8];h.g[9]=g[9]-i.g[9];h.g[10]=g[10]-i.g[10];h.g[11]=g[11]-i.g[11];h.g[12]=g[12]-i.g[12];h.g[13]=g[13]-i.g[13];h.g[14]=g[14]-i.g[14];h.g[15]=g[15]-i.g[15];return h;} translate( h,[ BB=0.0, CB=0.0]){var i;var n;var j;var t=h is m?h.w:1.0;if(h is k||h is m){i=h.x;n=h.y;j=h.z;}else{i=h;n=BB;j=CB;}var DB=g[0]*i+g[4]*n+g[8]*j+g[12]*t;var EB=g[1]*i+g[5]*n+g[9]*j+g[13]*t;var FB=g[2]*i+g[6]*n+g[10]*j+g[14]*t;var GB=g[3]*i+g[7]*n+g[11]*j+g[15]*t;g[12]=DB;g[13]=EB;g[14]=FB;g[15]=GB;return this;} eB( j){var i=MB.cos(j);var h=MB.sin(j);var DB=g[4]*i+g[8]*h;var BB=g[5]*i+g[9]*h;var n=g[6]*i+g[10]*h;var FB=g[7]*i+g[11]*h;var EB=g[4]*-h+g[8]*i;var CB=g[5]*-h+g[9]*i;var t=g[6]*-h+g[10]*i;var GB=g[7]*-h+g[11]*i;g[4]=DB;g[5]=BB;g[6]=n;g[7]=FB;g[8]=EB;g[9]=CB;g[10]=t;g[11]=GB;return this;} fB( j){var i=MB.cos(j);var h=MB.sin(j);var DB=g[0]*i+g[8]*h;var BB=g[1]*i+g[9]*h;var n=g[2]*i+g[10]*h;var FB=g[3]*i+g[11]*h;var EB=g[0]*-h+g[8]*i;var CB=g[1]*-h+g[9]*i;var t=g[2]*-h+g[10]*i;var GB=g[3]*-h+g[11]*i;g[0]=DB;g[1]=BB;g[2]=n;g[3]=FB;g[8]=EB;g[9]=CB;g[10]=t;g[11]=GB;return this;} gB( j){var i=MB.cos(j);var h=MB.sin(j);var DB=g[0]*i+g[4]*h;var BB=g[1]*i+g[5]*h;var n=g[2]*i+g[6]*h;var FB=g[3]*i+g[7]*h;var EB=g[0]*-h+g[4]*i;var CB=g[1]*-h+g[5]*i;var t=g[2]*-h+g[6]*i;var GB=g[3]*-h+g[7]*i;g[0]=DB;g[1]=BB;g[2]=n;g[3]=FB;g[4]=EB;g[5]=CB;g[6]=t;g[7]=GB;return this;} operator-(){var h=new l.mB();h[0]=-g[0];h[1]=-g[1];h[2]=-g[2];h[3]=-g[3];return h;} VB(){g[0]=1.0;g[1]=0.0;g[2]=0.0;g[3]=0.0;g[4]=0.0;g[5]=1.0;g[6]=0.0;g[7]=0.0;g[8]=0.0;g[9]=0.0;g[10]=1.0;g[11]=0.0;g[12]=0.0;g[13]=0.0;g[14]=0.0;g[15]=1.0;return this;} add( h){g[0]=g[0]+h.g[0];g[1]=g[1]+h.g[1];g[2]=g[2]+h.g[2];g[3]=g[3]+h.g[3];g[4]=g[4]+h.g[4];g[5]=g[5]+h.g[5];g[6]=g[6]+h.g[6];g[7]=g[7]+h.g[7];g[8]=g[8]+h.g[8];g[9]=g[9]+h.g[9];g[10]=g[10]+h.g[10];g[11]=g[11]+h.g[11];g[12]=g[12]+h.g[12];g[13]=g[13]+h.g[13];g[14]=g[14]+h.g[14];g[15]=g[15]+h.g[15];return this;} hB( h){var n=(g[0]*h.g[0])+(g[4]*h.g[1])+(g[8]*h.g[2])+g[12];var j=(g[1]*h.g[0])+(g[5]*h.g[1])+(g[9]*h.g[2])+g[13];var i=(g[2]*h.g[0])+(g[6]*h.g[1])+(g[10]*h.g[2])+g[14];h.x=n;h.y=j;h.z=i;return h;}}